<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SpendCraft — Advanced Expense Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{
    --bg:#0f1724;
    --panel:rgba(255,255,255,0.06);
    --muted: #9aa4b2;
    --glass: rgba(255,255,255,0.06);
    --accent1:#6ee7b7;
    --accent2:#60a5fa;
    --danger:#ff6b6b;
    --radius:14px;
    --blur:12px;
    --glass-border: rgba(255,255,255,0.08);
    --glass-2: rgba(255,255,255,0.03);
    color-scheme: dark;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;color:#e6eef8;
    background:
      radial-gradient(1000px 400px at 10% 10%, rgba(96,165,250,0.08), transparent 10%),
      radial-gradient(600px 300px at 90% 80%, rgba(110,231,183,0.06), transparent 12%),
      linear-gradient(180deg,#071124 0%, #081225 40%, #071024 100%);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:28px;
  }
  .app{
    max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1fr 420px;gap:22px;align-items:start;
  }

  header{
    grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:6px;
  }
  .brand{display:flex;gap:12px;align-items:center}
  .logo{
    width:60px;height:60px;border-radius:16px;display:grid;place-items:center;font-weight:800;
    background:linear-gradient(135deg,var(--accent1),var(--accent2));color:#042029;font-size:22px;box-shadow:0 10px 30px rgba(2,6,23,0.6);
  }
  h1{margin:0;font-size:20px;letter-spacing:-0.3px}
  .sub{color:var(--muted);font-size:13px;margin-top:2px}

  .top-controls{display:flex;gap:10px;align-items:center}
  .btn{
    border:none;padding:10px 12px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));
    color:inherit;cursor:pointer;font-weight:600;font-size:14px;backdrop-filter: blur(6px);border:1px solid var(--glass-border);
    box-shadow: 0 6px 20px rgba(2,6,23,0.5);
  }
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04)}
  .btn.primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#03141a}
  .icon{opacity:0.9;margin-right:8px}

  .panel{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:var(--radius);padding:16px;border:1px solid var(--glass-border);backdrop-filter: blur(var(--blur));
  }

  .add-form{display:grid;grid-template-columns:1fr 140px;gap:12px;align-items:start}
  .field{display:flex;flex-direction:column;gap:8px}
  label{font-size:13px;color:var(--muted)}
  input[type=text], input[type=number], input[type=date], select, textarea{
    padding:12px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:inherit;
    outline:none;transition:all .18s;
  }
  input:focus, select:focus, textarea:focus{border-color:rgba(96,165,250,0.8);box-shadow:0 6px 20px rgba(96,165,250,0.06)}
  .row-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}

  .controls-row{display:flex;gap:8px;align-items:center;margin-top:10px}
  .pill{padding:8px 10px;border-radius:999px;background:linear-gradient(180deg, rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.03);font-weight:600}

  .tx-list{margin-top:14px;display:grid;gap:12px}
  .tx{
    display:flex;justify-content:space-between;gap:12px;align-items:center;padding:12px;border-radius:12px;
    border:1px solid rgba(255,255,255,0.02);background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
    transition:transform .18s, box-shadow .18s;
  }
  .tx:hover{transform:translateY(-6px);box-shadow:0 20px 40px rgba(2,6,23,0.6)}
  .tx-left{display:flex;gap:12px;align-items:center}
  .cat-bubble{width:56px;height:56px;border-radius:12px;display:grid;place-items:center;font-weight:700;font-size:13px}
  .meta{color:var(--muted);font-size:13px}
  .amount{font-weight:800;font-size:16px}
  .amount.positive{color:var(--accent1)}
  .amount.negative{color:var(--danger)}

  .tx-actions{display:flex;gap:8px}

  .sidebar{display:flex;flex-direction:column;gap:12px}
  .summary{
    display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:center;
  }
  .summary .card{
    padding:14px;border-radius:12px;text-align:center;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  }
  .big{font-size:18px;font-weight:800}
  .small{font-size:13px;color:var(--muted)}

  .chart{padding:12px;border-radius:12px}
  canvas{width:100% !important;height:220px !important}

  .filters{display:flex;gap:8px;align-items:center;margin-top:14px}

  .toast{
    position:fixed;left:50%;transform:translateX(-50%);bottom:28px;padding:12px 18px;border-radius:12px;background:linear-gradient(90deg,#0ea5a4,#60a5fa);color:#042029;font-weight:700;
    box-shadow:0 14px 40px rgba(2,6,23,0.6);display:flex;gap:8px;align-items:center;
  }

  @media(max-width:1000px){
    .app{grid-template-columns:1fr; padding:18px}
    header{flex-direction:column;align-items:flex-start;gap:12px}
    .add-form{grid-template-columns:1fr}
  }
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">SC</div>
        <div>
          <h1>SpendCraft</h1>
          <div class="sub">Beautiful expense tracking — private & offline</div>
        </div>
      </div>

      <div class="top-controls">
        <button id="backupBtn" class="btn ghost" title="Backup JSON">Backup</button>
        <button id="importBtn" class="btn ghost" title="Import CSV/JSON">Import</button>
        <button id="exportBtn" class="btn ghost" title="Export CSV">Export</button>
        <button id="themeBtn" class="btn primary" title="Toggle Theme">Toggle Theme</button>
      </div>
    </header>

    <main class="panel">
      <section class="panel card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:800;font-size:18px">Add transaction</div>
            <div class="small">Fast add, recurring, notes — everything</div>
          </div>
          <div class="pill" id="clock">Local time</div>
        </div>

        <form id="txForm" class="add-form" style="margin-top:12px">
          <div style="display:flex;flex-direction:column;gap:10px">
            <div class="field">
              <label>Description</label>
              <input id="desc" type="text" placeholder="e.g., Uber to office" />
            </div>

            <div class="row-2">
              <div class="field">
                <label>Category</label>
                <select id="category">
                  <option>Food</option><option>Transport</option><option>Shopping</option><option>Bills</option><option>Income</option><option>Other</option>
                </select>
              </div>
              <div class="field">
                <label>Amount (use - for expense)</label>
                <input id="amount" type="number" placeholder="-1200 or 5000" />
              </div>
            </div>

            <div class="row-2">
              <div class="field">
                <label>Date</label>
                <input id="date" type="date" />
              </div>
              <div class="field">
                <label>Recurring?</label>
                <select id="recurring">
                  <option value="none">None</option>
                  <option value="monthly">Monthly</option>
                </select>
              </div>
            </div>

            <div class="field">
              <label>Note (optional)</label>
              <textarea id="note" rows="2" placeholder="Add extra context..."></textarea>
            </div>

            <div class="controls-row">
              <button id="addBtn" type="button" class="btn primary">Add Transaction</button>
              <button id="clearBtn" type="button" class="btn ghost">Clear</button>
              <input id="fileInput" type="file" accept=".csv,.json" style="display:none" />
            </div>
          </div>

          <div style="display:flex;flex-direction:column;gap:12px">
            <div class="summary card">
              <div>
                <div class="small">Total Income</div>
                <div class="big" id="totalIncome">₹0</div>
              </div>
              <div>
                <div class="small">Total Expense</div>
                <div class="big" id="totalExpense">₹0</div>
              </div>
            </div>

            <div class="card chart">
              <canvas id="lineChart"></canvas>
            </div>

            <div class="card chart">
              <canvas id="pieChart"></canvas>
            </div>
          </div>
        </form>
      </section>

      <section class="panel card" style="margin-top:12px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:800">Transactions</div>
          <div style="display:flex;gap:8px;align-items:center">
            <input id="search" placeholder="Search description or note" style="padding:8px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04)"/>
            <select id="filterCat" style="padding:8px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04)">
              <option value="">All categories</option>
              <option>Food</option><option>Transport</option><option>Shopping</option><option>Bills</option><option>Income</option><option>Other</option>
            </select>
            <select id="sortBy" style="padding:8px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04)">
              <option value="date_desc">Newest</option>
              <option value="date_asc">Oldest</option>
              <option value="amount_desc">Biggest Expense</option>
              <option value="amount_asc">Smallest Expense</option>
            </select>
          </div>
        </div>

        <div id="txList" class="tx-list" style="margin-top:12px"></div>
        <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
          <div class="small" id="txCount">0 transactions</div>
          <div>
            <button id="undoBtn" class="btn ghost">Undo Delete</button>
            <button id="delAllBtn" class="btn ghost">Clear All</button>
          </div>
        </div>
      </section>

    </main>

    <aside class="sidebar">
      <div class="panel card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:800">Monthly Budget</div>
            <div class="small">Set a monthly spending goal</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <input id="budget" type="number" placeholder="0" style="padding:8px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04)"/>
            <button id="saveBudget" class="btn primary">Save</button>
          </div>
        </div>

        <div style="margin-top:12px">
          <div class="small">Used</div>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="big" id="used">₹0</div>
            <div class="small" id="budgetLabel">/ ₹0</div>
          </div>
          <div style="height:12px;background:rgba(255,255,255,0.03);border-radius:999px;margin-top:8px;overflow:hidden">
            <div id="budgetProgress" style="height:100%;width:0%;background:linear-gradient(90deg,var(--accent1),var(--accent2));"></div>
          </div>
        </div>
      </div>

      <div class="panel card">
        <div style="font-weight:800">Quick Actions</div>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
          <button id="exportCsv" class="btn">Export CSV</button>
          <button id="exportJson" class="btn">Export JSON</button>
          <button id="importCsv" class="btn ghost">Import CSV</button>
          <button id="importJson" class="btn ghost">Import JSON</button>
        </div>
      </div>

      <div class="panel card">
        <div style="font-weight:800">Settings</div>
        <div style="margin-top:8px" class="small">
          <label><input id="autoBackup" type="checkbox" /> Auto-backup to localStorage every 30s</label>
        </div>
      </div>
    </aside>
  </div>

  <div id="toastRoot"></div>

<script type="module">
const STORAGE_KEY = 'spendcraft_v2';
let state = { tx: [], budget: 0 };
let lastDeleted = null;
let autoBackupId = null;

const q = sel => document.querySelector(sel);
const qa = sel => Array.from(document.querySelectorAll(sel));

const descEl = q('#desc'), amountEl = q('#amount'), dateEl = q('#date'), noteEl = q('#note'),
      categoryEl = q('#category'), recurringEl = q('#recurring'), addBtn = q('#addBtn'), clearBtn = q('#clearBtn');

const txList = q('#txList'), totalIncomeEl = q('#totalIncome'), totalExpenseEl = q('#totalExpense'),
      lineChartCanvas = q('#lineChart'), pieChartCanvas = q('#pieChart');

const searchEl = q('#search'), filterCatEl = q('#filterCat'), sortByEl = q('#sortBy');
const undoBtn = q('#undoBtn'), delAllBtn = q('#delAllBtn'), txCountEl = q('#txCount');

const exportBtn = q('#exportBtn'), importBtn = q('#importBtn'), fileInput = q('#fileInput'),
      backupBtn = q('#backupBtn'), themeBtn = q('#themeBtn');

const exportCsvBtn = q('#exportCsv'), exportJsonBtn = q('#exportJson'), importCsvBtn = q('#importCsv'), importJsonBtn = q('#importJson');
const budgetInput = q('#budget'), saveBudgetBtn = q('#saveBudget'), usedEl = q('#used'), budgetLabel = q('#budgetLabel'), budgetProgress = q('#budgetProgress');

const toastRoot = q('#toastRoot');

let lineChart = null, pieChart = null;
function initCharts(){
  lineChart = new Chart(lineChartCanvas.getContext('2d'), {
    type: 'line',
    data: { labels: [], datasets: [{ label: 'Expense', data: [], backgroundColor:'rgba(96,165,250,0.08)', borderColor:'#60a5fa', tension:0.35, fill:true }]},
    options: { scales:{ y:{ beginAtZero:true }}, plugins:{ legend:{ display:false } } }
  });
  pieChart = new Chart(pieChartCanvas.getContext('2d'), {
    type:'pie',
    data:{ labels:[], datasets:[{ data:[], backgroundColor: [] }]},
    options:{ plugins:{ legend:{ position:'bottom' } } }
  });
}

function load(){
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw) state = JSON.parse(raw);
  } catch(e){ console.error('load err',e); }
}
function save(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

const uid = () => Date.now().toString(36) + Math.random().toString(36).slice(2,6);
const currency = n => '₹' + Number(n).toFixed(2);
const nowISO = () => new Date().toISOString();
const toast = (text, ms=2800) => {
  const el = document.createElement('div');
  el.className = 'toast'; el.textContent = text;
  toastRoot.appendChild(el);
  setTimeout(()=> el.style.opacity=0, ms-500);
  setTimeout(()=> el.remove(), ms);
};

function render(){
  const qtxt = searchEl.value.trim().toLowerCase();
  const cat = filterCatEl.value;
  let list = state.tx.slice();
  if(qtxt) list = list.filter(t => (t.desc + ' ' + (t.note||'')).toLowerCase().includes(qtxt));
  if(cat) list = list.filter(t => t.category === cat);
  if(sortByEl.value === 'date_desc') list.sort((a,b)=> new Date(b.date)-new Date(a.date));
  if(sortByEl.value === 'date_asc') list.sort((a,b)=> new Date(a.date)-new Date(b.date));
  if(sortByEl.value === 'amount_desc') list.sort((a,b)=> Math.abs(b.amount)-Math.abs(a.amount));
  if(sortByEl.value === 'amount_asc') list.sort((a,b)=> Math.abs(a.amount)-Math.abs(b.amount));

  txList.innerHTML = '';
  if(list.length === 0){
    txList.innerHTML = '<div class="small">No transactions yet — add one to get started.</div>';
  } else {
    for(const t of list){
      const el = document.createElement('div'); el.className = 'tx';
      const color = t.amount >= 0 ? 'linear-gradient(180deg,#d1fae5,#bbf7d0)' : 'linear-gradient(180deg,#ffe6e6,#ffdede)';
      el.innerHTML = `
        <div class="tx-left">
          <div class="cat-bubble" style="background:${color};width:56px;height:56px;border-radius:12px">
            ${t.category[0] || 'X'}
          </div>
          <div>
            <div style="font-weight:700">${t.desc}</div>
            <div class="meta">${new Date(t.date).toLocaleString()} • ${t.category}${t.recurring? ' • recurring':''}</div>
            ${t.note? `<div class="meta">${t.note}</div>`: ''}
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:12px">
          <div class="amount ${t.amount>=0? 'positive':'negative'}">${currency(t.amount)}</div>
          <div class="tx-actions">
            <button class="btn ghost small" data-id="${t.id}" data-action="edit">Edit</button>
            <button class="btn ghost small" data-id="${t.id}" data-action="del">Delete</button>
          </div>
        </div>
      `;
      txList.appendChild(el);
    }
  }

  const totalIncome = state.tx.filter(x=> x.amount>0).reduce((s,x)=> s + x.amount,0);
  const totalExpense = state.tx.filter(x=> x.amount<0).reduce((s,x)=> s + Math.abs(x.amount),0);
  totalIncomeEl.textContent = currency(totalIncome);
  totalExpenseEl.textContent = currency(totalExpense);

  const used = totalExpense;
  usedEl.textContent = currency(used);
  budgetLabel.textContent = '/ ' + currency(state.budget || 0);
  const pct = state.budget > 0 ? Math.min(100, Math.round((used/state.budget)*100)) : 0;
  budgetProgress.style.width = pct + '%';
  if(pct >= 90 && pct < 100) toast('You are close to your monthly budget!', 2500);
  if(pct >= 100) toast('Budget exceeded!', 3600);

  const months = [];
  const mdata = [];
  for(let i=11;i>=0;i--){
    const d = new Date(); d.setMonth(d.getMonth()-i);
    const key = `${d.getFullYear()}-${('0'+(d.getMonth()+1)).slice(-2)}`;
    months.push(key);
    const total = state.tx.filter(t => {
      const k = `${new Date(t.date).getFullYear()}-${('0'+(new Date(t.date).getMonth()+1)).slice(-2)}`;
      return k === key && t.amount < 0;
    }).reduce((s,x)=> s + Math.abs(x.amount), 0);
    mdata.push(total);
  }
  lineChart.data.labels = months;
  lineChart.data.datasets[0].data = mdata;
  lineChart.update();

  const byCat = {};
  state.tx.filter(t=> t.amount<0).forEach(t => byCat[t.category] = (byCat[t.category]||0) + Math.abs(t.amount));
  const labels = Object.keys(byCat);
  const vals = labels.map(l=> byCat[l]);
  const colors = labels.map((_,i)=> `hsl(${i*70%360} 70% 55%)`);
  pieChart.data.labels = labels;
  pieChart.data.datasets[0].data = vals;
  pieChart.data.datasets[0].backgroundColor = colors;
  pieChart.update();

  txCountEl.textContent = `${state.tx.length} transactions`;
  save();
}

function addTransaction(obj){
  const tx = Object.assign({ id: uid(), desc:'', amount:0, category:'Other', date: nowISO(), recurring:'none', note:'' }, obj);
  state.tx.unshift(tx);
  render();
}

addBtn.addEventListener('click', ()=>{
  const desc = descEl.value.trim();
  const amount = parseFloat(amountEl.value);
  const date = dateEl.value ? new Date(dateEl.value).toISOString() : nowISO();
  const category = categoryEl.value;
  const recurring = recurringEl.value;
  const note = noteEl.value.trim();
  if(!desc || isNaN(amount)){ toast('Enter valid description & amount', 1800); return; }
  addTransaction({ desc, amount, date, category, recurring, note });
  descEl.value=''; amountEl.value=''; noteEl.value=''; dateEl.value='';
  toast('Added', 1200);
});

q('#txList').addEventListener('click', (ev)=>{
  const btn = ev.target.closest('button');
  if(!btn) return;
  const id = btn.dataset.id;
  const action = btn.dataset.action;
  if(action === 'del'){
    const idx = state.tx.findIndex(t=> t.id === id);
    if(idx === -1) return;
    lastDeleted = state.tx.splice(idx,1)[0];
    render();
    toast('Deleted — click Undo to restore', 2500);
  } else if(action === 'edit'){
    const tx = state.tx.find(t=> t.id === id);
    if(!tx) return;
    descEl.value = tx.desc; amountEl.value = tx.amount; categoryEl.value = tx.category;
    dateEl.value = new Date(tx.date).toISOString().slice(0,10); recurringEl.value = tx.recurring; noteEl.value = tx.note || '';
    state.tx = state.tx.filter(t=> t.id !== id);
    render();
  }
});

undoBtn.addEventListener('click', ()=>{
  if(!lastDeleted) return toast('Nothing to undo',1200);
  state.tx.unshift(lastDeleted);
  lastDeleted = null; render(); toast('Restored',1200);
});

delAllBtn.addEventListener('click', ()=>{
  if(!confirm('Clear all transactions? This cannot be undone.')) return;
  state.tx = []; render(); toast('Cleared all',1200);
});

searchEl.addEventListener('input', debounce(render, 250));
filterCatEl.addEventListener('change', render);
sortByEl.addEventListener('change', render);

exportCsvBtn.addEventListener('click', ()=>{
  const headers = ['id','desc','amount','category','date','recurring','note'];
  const rows = state.tx.map(t => headers.map(h => JSON.stringify(t[h]||'')).join(','));
  const csv = [headers.join(','), ...rows].join('\n');
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([csv], { type:'text/csv' }));
  a.download = `spendcraft_${new Date().toISOString().slice(0,10)}.csv`; a.click();
});

exportJsonBtn.addEventListener('click', ()=>{
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([JSON.stringify(state, null, 2)], { type:'application/json' }));
  a.download = `spendcraft_backup_${new Date().toISOString().slice(0,10)}.json`; a.click();
});

importCsvBtn.addEventListener('click', ()=> fileInput.click());
importJsonBtn.addEventListener('click', ()=> fileInput.click());
fileInput.addEventListener('change', (ev)=>{
  const f = ev.target.files[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = e=>{
    const txt = e.target.result;
    if(f.name.endsWith('.json')){
      try { const data = JSON.parse(txt); if(data.tx) state = data; else state.tx = JSON.parse(txt); save(); render(); toast('JSON imported',1200);} catch(err){toast('Invalid JSON',1500)}
    } else {
      try {
        const lines = txt.trim().split('\n').map(l=> l.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/));
        const headers = lines.shift().map(h => h.replace(/(^"|"$)/g,''));
        const parsed = lines.map(cols => {
          const obj = {}; headers.forEach((h,i)=> obj[h] = JSON.parse(cols[i]||'""'));
          obj.amount = Number(obj.amount); return obj;
        });
        state.tx = parsed.concat(state.tx); save(); render(); toast('CSV imported',1500);
      } catch(err){ toast('CSV parse failed',1500) }
    }
  };
  reader.readAsText(f);
});

backupBtn.addEventListener('click', ()=> {
  const json = JSON.stringify(state, null, 2);
  navigator.clipboard?.writeText(json).then(()=> toast('Backup copied to clipboard',1400), ()=> { const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([json])); a.download='spendcraft_backup.json'; a.click(); });
});

themeBtn.addEventListener('click', () => document.documentElement.classList.toggle('light'));

saveBudgetBtn.addEventListener('click', ()=> { state.budget = Number(budgetInput.value || 0); render(); toast('Budget saved',1200); });

setInterval(()=> q('#clock').textContent = new Date().toLocaleString(), 1000);

q('#autoBackup')?.addEventListener('change', (e)=>{
  if(e.target.checked) autoBackupId = setInterval(()=> localStorage.setItem(STORAGE_KEY, JSON.stringify(state)), 30000);
  else { clearInterval(autoBackupId); autoBackupId = null; }
});

function debounce(fn, ms=200){
  let t; return (...a)=> { clearTimeout(t); t=setTimeout(()=> fn(...a), ms); }
}

load();
initCharts();
render();

if('serviceWorker' in navigator){
  try { navigator.serviceWorker.register('/sw.js').catch(()=>{}); } catch(e){}
}
</script>
</body>
</html>
